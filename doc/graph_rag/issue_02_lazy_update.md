# オンデマンド（Lazy）エッジ更新機構の実装

## 概要

ctags的な陳腐化問題（静的な辞書がコード変更に追従できず即座に腐る問題）を解決するため、ナレッジグラフデータベースの部分ツリーを、「LLMが要求した瞬間に必要な範囲に限りパースし直して遅延更新（Lazy Update）」する仕組みを構築する。

## 要件

- ファイルの変更検知メカニズム（ファイルハッシュの保持など）
- 「LLMの特定クエリ（例: `get_call_graph(FuncName)`）」をトリガーとし、関連する起点ファイルの変更ハッシュを確認
- 差分があった場合、Issue 01等のアダプタやパーサーを用いて**必要な部分のみ**を再解析（部分ツリーの再構築）し、ローカルグラフにパッチを当てる処理
- この一連のフローを抽象化したキャッシュ無効化・更新マネージャーの追加
- （関連事項として、将来的なロードマップ4.2に規定されているメモリ逼迫を防ぐための適切なキャッシュ破棄・永続化戦略等との整合性確認）

## 関連仕様

- `doc/graph_rag/specification.md` の「動的追従性（ctags問題）の解決策：オンデマンド部分更新」

## 完了条件

- 要求された部分がキャッシュや永続化DBに存在し、変更がない場合はキャッシュから返すこと
- 起点ファイルに変更が生じた場合は、LLMからの要求を契機として必要なグラフ情報が直ちに再フェッチ／再パースされ、返却結果が更新されること
- 関連する更新ロジックのテストが追加されていること

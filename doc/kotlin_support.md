# Kotlin対応の現状とロードマップ

このドキュメントは、MCPサーバーにおけるKotlin言語サポートの現状と、今後の開発ロードマップを詳述します。

## 1. 現状のKotlin対応

現在のMCPサーバーは、モジュール式パーサー設計の導入により、Kotlinコードを解析するための基盤が構築されています。具体的には、以下の機能が実装されています。

- **モジュール式パーサー設計の導入**:
  - `IParser` インターフェースが定義され、各言語のパーサーがこのインターフェースを実装するようになりました。
  - `ParserFactory` が導入され、言語タイプ（例: "swift", "kotlin"）に基づいて適切なパーサーのインスタンスを提供するメカニズムが確立されました。
- **`KotlinParser` の実装**:
  - `IParser` インターフェースを実装する `KotlinParser` クラスが追加されました。
  - この `KotlinParser` は `ParserFactory` に登録されており、Kotlinファイル（`.kt` 拡張子）の解析リクエストがあった際に `AnalysisService` から利用されます。
- **Kotlin AST JSON出力CLIツールとの連携**:
  - `KotlinParser` は、外部のKotlin AST JSON出力CLIツール (`kotlin-parser-cli.jar`) を呼び出し、そのJSON出力をパースして `CodeChunk` オブジェクトに変換するようになりました。
  - これにより、Kotlinコードの基本的な構文解析と、関数やクラスなどの要素の `CodeChunk` への変換が可能です。

## 2. 今後のロードマップ

Kotlinコードの本格的な解析機能のさらなる強化に向けて、以下のステップを計画しています。

### 2.1. `KotlinParser` の機能強化

- **`CodeChunk` への正確な変換のさらなる改善**:
  - 外部ツールからの出力を、`CodeChunk` インターフェースに定義された形式（関数名、シグネチャ、型、コード内容、行番号、オフセット、長さ、呼び出し関係など）に、より正確に変換するロジックを実装します。
  - 特に、関数だけでなく、プロパティ、変数などのより多様なコード要素を `CodeChunk` として抽出できるように機能を拡張します。

### 2.1.1. Kotlin AST JSON出力CLIツールの開発 (解決済み)

### 2.1.2. `KotlinParser` からCLIツールの呼び出しと`CodeChunk`変換 (解決済み)

### 2.2. テストカバレッジの向上

- [x] 実際のKotlinコードファイルを使用した統合テストを追加し、`KotlinParser` が正しく機能することを確認します。
- エッジケース（コメントのみのファイル、構文エラーのあるファイルなど）に対するテストを追加します。

### 2.3. パフォーマンス最適化

- 大規模なKotlinコードベースを解析する際のパフォーマンスボトルネックを特定し、最適化を行います。
- チャンクのキャッシュ戦略や、外部ツールとの連携方法の効率化を検討します。

## 3. ロードマップにおける位置づけ

このKotlin対応のロードマップは、MCPサーバー開発ロードマップの「フェーズ2: 言語サポートの拡張」の一部を構成します。

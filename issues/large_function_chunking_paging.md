# 巨大関数の簡易的な小チャンク化（ページング）

## 概要

既存の `get_function_chunk` および `get_chunk` ツールが返すコードチャンクが一定以上の大きさである場合に、そのチャンクをページング可能にする機能を追加します。これにより、巨大な関数でも扱いやすいサイズで取得できるようになります。

## 詳細

### 優先度

高

### 問題点

- 巨大な関数を一度に取得すると、LLMのコンテキストウィンドウを圧迫したり、処理が重くなる可能性があります。
- 意味的な分割は複雑であるため、まずは簡易的なページング機能で対応します。

### 提案仕様

#### 対象ツール

- `get_function_chunk`: 特定の関数のコードチャンクを取得するツール。
- `get_chunk`: チャンクIDでコードチャンクを取得するツール。

#### ページングのトリガー

- チャンクの `content` の行数、またはバイト数が、定義された閾値（例: 500行、10KBなど）を超えた場合にページングを適用します。閾値は設定可能にするのが望ましいです。

#### 応答の追加情報

既存の `CodeChunk` インターフェースに以下のフィールドを追加することを検討します。

- `isPartial: boolean`: このチャンクが完全なコードチャンクの一部である場合に `true`。
- `totalLines: number` (オプション): 元の巨大関数の総行数。
- `currentPage: number` (オプション): 現在のチャンクが何ページ目か。
- `totalPages: number` (オプション): 元の巨大関数の総ページ数。
- `nextPageToken: string` (オプション): 次のページをリクエストするためのトークン。
- `prevPageToken: string` (オプション): 前のページをリクエストするためのトークン。

#### リクエストの追加引数

`get_function_chunk` および `get_chunk` ツールに以下のオプショナルな引数を追加します。

- `pageToken: string` (オプション): 次のページまたは前のページをリクエストするためのトークン。
- `pageSize: number` (オプション): 1ページあたりの行数またはバイト数を指定。デフォルト値はサーバー側で定義。

#### ページングのロジック

- サーバー側で、`pageToken` を解析し、対応するチャンクの範囲を特定します。
- `pageToken` は、ファイルパス、関数シグネチャ、開始オフセット、終了オフセット、ページサイズなどの情報をエンコードした文字列とします。これにより、ステートレスなページングが可能になります。

## その他

ロードマップの「フェーズ3: 高度なコード理解機能」の「3.2. コードチャンクの粒度拡張」に関連します。
